######################
# Import & Download Data  
######################

## Install and run RMariaDB
install.packages("RMariaDB")
library(RMariaDB) 

## Create a database connection 
con = dbConnect(MariaDB(), user='deepAnalytics',
                password='Sqltask1234!', dbname='dataanalytics2018', 
                host='data-analytics-2018.cbrosir2cswx.us-east-1.rds.amazonaws.com')

## List the tables contained in the database 
dbListTables(con)

## Use asterisk to specify all attributes for download
irisALL <- dbGetQuery(con, "SELECT * FROM iris")
sixALL <- dbGetQuery(con, "SELECT * FROM yr_2006")
sevenALL <- dbGetQuery(con, "SELECT * FROM yr_2007")
eightALL <- dbGetQuery(con, "SELECT * FROM yr_2008")
nineALL <- dbGetQuery(con, "SELECT * FROM yr_2009")
tenALL <- dbGetQuery(con, "SELECT * FROM yr_2010")

######################
# Pre-Processing  
######################

summary(sixALL)
summary(sevenALL)
summary(eightALL)
summary(nineALL)
summary(tenALL)


str(sixALL)
str(sevenALL)
str(eightALL)
str(nineALL)
str(tenALL)

is.na(sixALL)
is.na(sevenALL)
is.na(eightALL)
is.na(nineALL)
is.na(tenALL)

anyNA(sixALL)
anyNA(sevenALL)
anyNA(eightALL)
anyNA(nineALL)
anyNA(tenALL)


dbGetQuery(con, "SELECT distinct date FROM yr_2010" )

## Use attribute names to specify specific attributes for download
irisSELECT <- dbGetQuery(con, "SELECT SepalLengthCm, SepalWidthCm FROM iris")

## Install and run dplyr
install.packages("dplyr")
library(dplyr)

## Combine tables into one dataframe using dplyr
newDF <- bind_rows(sevenALL, eightALL, nineALL)

## Combine Date and Time attribute values in a new attribute column
newDF <-cbind(newDF,paste(newDF$Date,newDF$Time), stringsAsFactors=FALSE)

## Give the new attribute in the 11th column a header name 
colnames(newDF)[11] <-"DateTime"

## Move the DateTime attribute within the dataset
newDF <- newDF[,c(ncol(newDF), 1:(ncol(newDF)-1))]
head(newDF)

## Convert DateTime from character to POSIXct 
newDF$DateTime <- as.POSIXct(newDF$DateTime, "%Y/%m/%d %H:%M:%S")

## Add the time zone
attr(newDF$DateTime, "tzone") <- "Europe/Paris"

## Inspect the data types
str(newDF)

## Install and run lubridate
install.packages("lubridate")
library(lubridate)

## Create "year" attribute with lubridate
newDF$year <- year(newDF$DateTime)

## Create "quarter" attribute with lubridate
newDF$quarter <- quarter(newDF$DateTime)

## Create "month" attribute with lubridate
newDF$month <- month(newDF$DateTime)

## Create "week" attribute with lubridate
newDF$week <- week(newDF$DateTime)

## Create "day" attribute with lubridate
newDF$day <- day(newDF$DateTime)

## Create "hour" attribute with lubridate
newDF$hour <- hour(newDF$DateTime)

## Create "minute" attribute with lubridate
newDF$minute <- minute(newDF$DateTime)

## Create "weekdays" attribute with lubridate
newDF$weekdays <- weekdays(newDF$DateTime)

######################
# EDA  
######################

## Plot
plot(newDF$Sub_metering_1)

plot(newDF$Sub_metering_2)

plot(newDF$Sub_metering_3)

hist(newDF$Sub_metering_1)

hist(newDF$Sub_metering_2) 

hist(newDF$Sub_metering_3)


